(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{426:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"进程和线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#进程和线程"}},[t._v("#")]),t._v(" 进程和线程")]),t._v(" "),s("p",[t._v("进程：负责为程序运行提供必备环境，资源分配和调度的基本单位，线程的容器；相当于工厂中车间")]),t._v(" "),s("p",[t._v("线程：计算机中最小的计算单位，负责执行进程中的程序；相当于车间里的工人")]),t._v(" "),s("p",[t._v("JS是单线程，因为主要用途是与用户互动以及操作DOM，同一时间多个操作DOM的行为将会带来复杂的同步问题")]),t._v(" "),s("p",[t._v("其他主流程序为多线程")]),t._v(" "),s("p",[t._v("当我们启动一个"),s("code",[t._v("js")]),t._v("文件，实际就是开启了一个服务进程，每个进程都拥有自己的独立空间地址、数据栈，像另一个进程无法访问当前进程的变量、数据结构，只有数据通信后，进程之间才可以数据共享")]),t._v(" "),s("p",[t._v("由于"),s("code",[t._v("JavaScript")]),t._v("是一个单线程语言，所以通过"),s("code",[t._v("node xxx")]),t._v("启动一个文件后，只有一条主线程")]),t._v(" "),s("h2",{attrs:{id:"谈谈对node-js的理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#谈谈对node-js的理解"}},[t._v("#")]),t._v(" 谈谈对node.js的理解")]),t._v(" "),s("p",[s("code",[t._v("Node.js")]),t._v(" 就是一个"),s("strong",[t._v("服务器端")]),t._v("的、"),s("strong",[t._v("非阻塞式I/O")]),t._v("(input/output)的、"),s("strong",[t._v("事件驱动")]),t._v("的"),s("code",[t._v("JavaScript")]),t._v("运行环境")]),t._v(" "),s("p",[t._v("【node.js把js战场从浏览器迁到了服务器】")]),t._v(" "),s("blockquote",[s("p",[t._v("非阻塞(异步)I/O，通过网络或存储介质读取或写入数据（输入输出操作）")]),t._v(" "),s("p",[t._v("事件驱动：新请求压入事件队列，当检测到事件状态变化，则执行其对应处理代码（回调函数）")]),t._v(" "),s("p",[t._v("node.js是平台，js是编程语言，js作为客户端编程语言需要浏览器js解释器解释执行，所以node.js就是把浏览器解释器封装起来作为服务器运行平台，让js运行在服务器端的开发平台")])]),t._v(" "),s("p",[t._v("非阻塞：Node.js"),s("strong",[t._v("异步编程")]),t._v("，可以"),s("strong",[t._v("一边读取数据，一边执行其他命令")]),t._v("，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 "),s("code",[t._v("I/O")]),t._v(" 操作。这就大大提高了 "),s("code",[t._v("Node.js")]),t._v(" 的性能，可以处理大量的"),s("strong",[t._v("并发")]),t._v("请求")]),t._v(" "),s("p",[t._v("node处理请求时是单线程的，但是在后台有一个I/O线程池")]),t._v(" "),s("p",[t._v("node用途：")]),t._v(" "),s("p",[t._v("后端的web服务，如跨域、服务器端的请求")]),t._v(" "),s("p",[t._v("基于web的应用")]),t._v(" "),s("p",[t._v("多客户端的通信，如即使通信")]),t._v(" "),s("p",[t._v("实时多人游戏")]),t._v(" "),s("p",[t._v("web服务API，如REST")]),t._v(" "),s("p",[t._v("node执行js文件：node xx.js")]),t._v(" "),s("h3",{attrs:{id:"commonjs-模块化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#commonjs-模块化"}},[t._v("#")]),t._v(" CommonJS-模块化")]),t._v(" "),s("p",[t._v("模块引用【require】、模块定义【js文件】、模块标识【路径、核心模块名字】")]),t._v(" "),s("p",[s("strong",[t._v("模块："),s("strong",[t._v("在node中一个js文件就是一个模块，主要是为了实现不同")]),t._v("功能")])]),t._v(" "),s("p",[t._v("模块两大类：")]),t._v(" "),s("blockquote",[s("p",[t._v("核心模块：由node引擎提供的模块，如fs")]),t._v(" "),s("p",[t._v("文件模块：用户自己创建的模块")])]),t._v(" "),s("p",[s("strong",[t._v("引入模块")]),t._v("："),s("strong",[t._v("require")]),t._v("('')参数为文件路径")]),t._v(" "),s("p",[t._v("使用require引入模块以后，该函数会返回一个对象，代表引入模块")]),t._v(" "),s("p",[s("strong",[t._v("暴露：")])]),t._v(" "),s("p",[t._v("在node中，每一个js文件中的js代码都是独立包装在一个函数中【并且函数执行时传入了五个实参exports, require, module, __filename【完整路径】, __dirname【文件夹路径】】，而不是全局作用域，所以一个模块中的变量和函数无法在其他模块中访问，var声明变量只能在当前模块中使用---\x3e "),s("strong",[t._v("向外部暴露属性或方法exports")]),t._v("---"),s("code",[t._v("exports.x = function(){}")]),t._v("这样才能被引用后访问")]),t._v(" "),s("p",[t._v("所以应该这样使用")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" md "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./xx.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("x")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这样调用，因为require返回一个对象")]),t._v("\n")])])]),s("p",[s("strong",[t._v("module.exports和exports的区别")])]),t._v(" "),s("p",[t._v("通过eports只能通过.的方式向外暴露内部变量")]),t._v(" "),s("p",[t._v("module.exports不仅可以通过.还可以直接赋值，比如module.exports = {}")]),t._v(" "),s("p",[s("strong",[t._v("包")]),t._v("：")]),t._v(" "),s("p",[t._v("实际上就是一个压缩文件，包装后的模块")]),t._v(" "),s("p",[s("strong",[t._v("-package.json 描述文件")])]),t._v(" "),s("p",[t._v("-bin\t可执行二进制文件")]),t._v(" "),s("p",[t._v("-lib js代码")]),t._v(" "),s("p",[t._v("-doc 文档")]),t._v(" "),s("p",[t._v("-test 单元测试")]),t._v(" "),s("p",[s("strong",[t._v("npm:")])]),t._v(" "),s("p",[t._v("Node Package Manager")]),t._v(" "),s("p",[t._v("对于node而言，npm帮助其完成了第三方模块的发布、安装和依赖等，借助npm，node与第三方模块之间形成了很好的生态系统")]),t._v(" "),s("blockquote",[s("p",[t._v("npm version 查看版本")]),t._v(" "),s("p",[t._v("npm search 搜索")]),t._v(" "),s("p",[t._v("npm install 包名 安装")]),t._v(" "),s("p",[t._v("npm install 包名 -g 安装全局依赖包")]),t._v(" "),s("p",[t._v("npm install 下载当前项目所依赖的包")]),t._v(" "),s("p",[t._v("npm remove 删除")])]),t._v(" "),s("h2",{attrs:{id:"es-module和commonjs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es-module和commonjs"}},[t._v("#")]),t._v(" ES Module和CommonJS")]),t._v(" "),s("p",[t._v("解决了变量污染，文件依赖等问题")]),t._v(" "),s("p",[t._v("1.import在"),s("strong",[t._v("代码编译")]),t._v("时被加载，所以必须放在文件开头（静态加载），require在"),s("strong",[t._v("代码运行")]),t._v("时被加载，所以require理论上可以运用在代码的任何地方（可以放在判断语句中动态加载），所以import性能更好。\n2.import引入的对象被修改时，源对象也会被修改，相当于"),s("strong",[t._v("浅拷贝")]),t._v("，require引入的对象被修改时，源对象不会被修改，官网称值拷贝，我们可以理解为"),s("strong",[t._v("深拷贝")]),t._v("。")]),t._v(" "),s("p",[t._v("CommonJS 深拷贝，ES6浅拷贝（也就是CommonJs可以修改输出的值，ES6不可以）")]),t._v(" "),s("h4",{attrs:{id:"动态加载commonjs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态加载commonjs"}},[t._v("#")]),t._v(" 动态加载CommonJS")]),t._v(" "),s("p",[t._v("CommonJS 可以在判断语句中导入，代码发生在运行时；而ESM为静态的，不可以动态加载语句，只能声明在该文件的最顶部，代码发生在编译时")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lists "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./index.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./config.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nlists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 动态导入")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 动态导入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"导出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导出"}},[t._v("#")]),t._v(" 导出")]),t._v(" "),s("p",[s("code",[t._v("CommonJs")]),t._v("中使用"),s("code",[t._v("module.exports")]),t._v("导出变量及函数，也可以导出任意类型的值")]),t._v(" "),s("p",[s("code",[t._v("Es Module")]),t._v("中导出分为两种，单个导出("),s("code",[t._v("export")]),t._v(")、默认导出("),s("code",[t._v("export default")]),t._v(")")]),t._v(" "),s("p",[t._v("注意默认就是把全部都导入或者导出")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// CommonJS")]),t._v("\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"蛙人"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sex")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"male"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ES Module")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"蛙人"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" age "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("，\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("msg")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello 蛙人"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"导入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导入"}},[t._v("#")]),t._v(" 导入")]),t._v(" "),s("p",[s("code",[t._v("CommonJs")]),t._v("中使用"),s("code",[t._v("require")]),t._v("语法可以导入")]),t._v(" "),s("p",[s("code",[t._v("Es Module")]),t._v("使用的是"),s("code",[t._v("import")]),t._v("语法进行导入。如果要单个导入则必须使用花括号"),s("code",[t._v("{}")]),t._v(" ，"),s("strong",[t._v("注意：这里的花括号跟解构不一样")]),t._v("，"),s("code",[t._v("import")]),t._v("语句必须先是默认导出，后面再是单个导出，顺序一定要正确否则报错")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./index.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./index.js'")]),t._v(" \n")])])]),s("h2",{attrs:{id:"node对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node对象"}},[t._v("#")]),t._v(" node对象")]),t._v(" "),s("p",[s("strong",[t._v("global")])]),t._v(" "),s("p",[t._v("全局变量，作用和网页中window类似")]),t._v(" "),s("p",[t._v("全局中创建的变量作为global的属性保存，函数作为方法保存")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("a = 10;//不能用var a = 10，因为这样就还是函数内的变量了\nconsole.log(global.a); \n")])])]),s("p",[s("strong",[t._v("process")])]),t._v(" "),s("p",[t._v("进程对象，提供有关当前进程的信息和控制")]),t._v(" "),s("p",[s("code",[t._v("process.cwd()")]),t._v("返回当前node进程执行目录")]),t._v(" "),s("p",[s("code",[t._v("process.argv")]),t._v("获取传入的命令行参数，返回数组")]),t._v(" "),s("h3",{attrs:{id:"中间件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#中间件"}},[t._v("#")]),t._v(" 中间件")]),t._v(" "),s("p",[t._v("Middleware，介于应用系统和系统软件之间的一类软件，它使用系统软件所提供的基础服务（功能），衔接网络上应用系统的各个部分或不同的应用，能够达到资源共享、功能共享的目的")]),t._v(" "),s("p",[t._v("在这些中间件函数中，我们可以执行业务逻辑代码，修改请求和响应对象、返回响应数据等操作")]),t._v(" "),s("p",[s("code",[t._v("koa")]),t._v("是基于"),s("code",[t._v("NodeJS")]),t._v("当前比较流行的"),s("code",[t._v("web")]),t._v("框架，"),s("code",[t._v("Koa")]),t._v(" 中间件采用的是洋葱圈模型，每次执行下一个中间件传入两个参数：")]),t._v(" "),s("ul",[s("li",[t._v("ctx ：封装了request 和 response 的变量")]),t._v(" "),s("li",[t._v("next ：进入下一个要执行的中间件的函数")])]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("NodeJS")]),t._v("中，中间件主要是指封装"),s("code",[t._v("http")]),t._v("请求细节处理的方法")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取 token")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" token "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("authorization\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// verify 函数验证 token，并获取用户相关信息")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("verify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 进入下一个中间件")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"buffer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#buffer"}},[t._v("#")]),t._v(" buffer")]),t._v(" "),s("p",[t._v("缓冲区，结构、操作方法和数组很像，其内元素为16进制两位数，用户空间传输数据的容器【需要处理图片、文件、数据库、网络协议的场合】")]),t._v(" "),s("p",[t._v("数组中不能存储二进制文件，而buffer存储的都是二进制数据【但是显示是以16进制显示，每个元素范围从00-ff】")]),t._v(" "),s("p",[t._v("8bit = 1 byte（字节，数据传输最小单位，八位二进制）")]),t._v(" "),s("p",[t._v("使用buffer不需要引入模块，直接使用即可")]),t._v(" "),s("p",[t._v("创建："),s("code",[t._v("var buf = Buffer.from(str)")])]),t._v(" "),s("p",[s("code",[t._v("var buf2 = Buffer.alloc(10)")]),t._v("创建10个字节的buffer，创建内存")]),t._v(" "),s("p",[t._v("通过索引赋值 "),s("code",[t._v("buf2[0] = 88")]),t._v(" ，但buffer大小一旦确定不能修改，超出索引值的修改不行")]),t._v(" "),s("h3",{attrs:{id:"fs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fs"}},[t._v("#")]),t._v(" fs")]),t._v(" "),s("p",[t._v("文件系统 file system")]),t._v(" "),s("p",[t._v("提供异步（不具有Sync后缀）和同步（有Sync后缀）两种操作方式")]),t._v(" "),s("p",[t._v("通过node来操作系统中的文件，服务器的本质就是将本地的文件发送给远程的客户端")]),t._v(" "),s("p",[t._v("node通过fs文件来和文件系统进行交互，fs提供了一些标准文件访问API来打开、读取、写入文件以及与其交互。")]),t._v(" "),s("p",[t._v("要使用fs模块，首先对其进行加载 "),s("code",[t._v("const fs = require('fs')")])]),t._v(" "),s("p",[t._v("fs模块中所有操作有两种形式可以选择---同步和异步【不会阻塞程序的执行，操作完成时通过回调函数将结果返回】")]),t._v(" "),s("p",[s("strong",[t._v("文件写入")])]),t._v(" "),s("blockquote",[s("ol",[s("li",[s("p",[t._v("打开文件")]),t._v(" "),s("p",[t._v("fs.open(path, flags[, mode], callback)")]),t._v(" "),s("p",[t._v("​\t-path 文件路径")]),t._v(" "),s("p",[t._v("​\t-flags 要操作类型，r只读的/w可写的")]),t._v(" "),s("p",[t._v("​\t-mode 设置文件操作权限")]),t._v(" "),s("p",[t._v("回调函数两个参数：err错误对象(没有则为null)，fd文件描述符")])]),t._v(" "),s("li",[s("p",[t._v("向文件中写入内容")]),t._v(" "),s("p",[t._v("fs.write(fd, string[, postion[, encoding]], callback)")]),t._v(" "),s("p",[t._v("​\t-fd 文件描述符")]),t._v(" "),s("p",[t._v("​\t-string 要写入的内容")])]),t._v(" "),s("li",[s("p",[t._v("保存并关闭文件")]),t._v(" "),s("p",[t._v("fs.close(fd, callback) 传入文件描述符")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("fs.openSync('hello.txt', 'w', function(err, fd){\n    if (!err){\n        fs.write(fd, 'hello', function(err){\n            if (!err){\n                fs.close(fd, function(err){\n                    if (!err){\n                        console.log('写入成功')\n                    }\n                })\n            }\n        })\n    }\n})\n")])])])])])]),t._v(" "),s("p",[s("strong",[t._v("简单文件写入/读取")])]),t._v(" "),s("p",[t._v("fs.writeFile(file, data[, options], callback)")]),t._v(" "),s("p",[t._v("fs.readFile(file, data[, options], callback)")]),t._v(" "),s("p",[s("strong",[t._v("大文件写入/读取")])]),t._v(" "),s("p",[t._v("流式文件写入")]),t._v(" "),s("p",[t._v("创建一个可写/可读流")]),t._v(" "),s("p",[s("code",[t._v("var ws = fs.createWriteStream(path[,options])")])]),t._v(" "),s("p",[s("code",[t._v("var ws = fs.createReadStream(path[,options])")])]),t._v(" "),s("p",[t._v("通过可写流向文件写入内容，ws.write('你好')")]),t._v(" "),s("p",[t._v("ws.end()关闭流")]),t._v(" "),s("h3",{attrs:{id:"stream流"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stream流"}},[t._v("#")]),t._v(" Stream流")]),t._v(" "),s("p",[t._v("是一个数据传输手段，是端到端信息交换的一种方式，而且是有顺序的，是逐块读取数据、处理内容，用于顺序读取输入或写入输出")]),t._v(" "),s("p",[t._v("可以分成三部分："),s("code",[t._v("source")]),t._v("、"),s("code",[t._v("dest")]),t._v("、"),s("code",[t._v("pipe")])]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("source")]),t._v("和"),s("code",[t._v("dest")]),t._v("之间有一个连接的管道"),s("code",[t._v("pipe")]),t._v(",它的基本语法是"),s("code",[t._v("source.pipe(dest)")]),t._v("，"),s("code",[t._v("source")]),t._v("和"),s("code",[t._v("dest")]),t._v("就是通过pipe连接，让数据从"),s("code",[t._v("source")]),t._v("流向了"),s("code",[t._v("dest")]),t._v("，如下图所示：")]),t._v(" "),s("p",[t._v("可写流 "),s("code",[t._v("fs.createWriteStream(path[,options])")])]),t._v(" "),s("p",[t._v("可读流 "),s("code",[t._v("fs.createReadStream(path[,options])")])]),t._v(" "),s("p",[t._v("双工流-既可写又可读 如net.Socket")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 两个文件名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fileName1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fileName2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data-bak.txt'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读取文件的 stream 对象")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" readStream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReadStream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileName1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写入文件的 stream 对象")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" writeStream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWriteStream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fileName2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过 pipe执行拷贝，数据流转")]),t._v("\nreadStream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("writeStream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据读取完成监听，即拷贝完成")]),t._v("\nreadStream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'拷贝完成'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"eventemitter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eventemitter"}},[t._v("#")]),t._v(" EventEmitter")]),t._v(" "),s("p",[t._v("EventEmitter为类，这个类实现了"),s("code",[t._v("Node")]),t._v("异步事件驱动架构的基本模式——"),s("strong",[t._v("观察者模式")])]),t._v(" "),s("p",[t._v("观察者模式中，被观察者(主体)维护着一组其他对象派来(注册)的观察者，有新的对象对主体感兴趣就注册观察者，不感兴趣就取消订阅，主体有更新的话就依次通知观察者们")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" EventEmitter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'events'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEmitter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EventEmitter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myEmitter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'触发了event事件！'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmyEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'event'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmyEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'event'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmyEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'event'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// addListener为添加事件监听")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// once为添加后执行一次并删除")]),t._v("\n")])])]),s("p",[s("code",[t._v("EventEmitter")]),t._v("是一个构造函数，内部存在一个包含所有事件的对象")]),t._v(" "),s("h3",{attrs:{id:"jwt鉴权机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jwt鉴权机制"}},[t._v("#")]),t._v(" jwt鉴权机制")]),t._v(" "),s("p",[t._v("JWT（JSON Web Token），本质就是一个字符串书写规范，如下图，作用是用来在用户和服务器之间传递安全可靠的信息【可以防护CSRF】")]),t._v(" "),s("p",[t._v("在目前前后端分离的开发过程中，使用"),s("code",[t._v("token")]),t._v("鉴权机制用于身份验证是最常见的方案，流程如下：")]),t._v(" "),s("ul",[s("li",[t._v("服务器当验证用户账号和密码正确的时候，给用户颁发一个令牌，这个令牌作为后续用户访问一些接口的凭证")]),t._v(" "),s("li",[t._v("后续访问会根据这个令牌判断用户时候有权限进行访问")])]),t._v(" "),s("p",[s("code",[t._v("Token")]),t._v("，分成了三部分，头部（Header）【声明使用算法】、载荷（Payload）【用户的id和name】、签名（Signature），并以"),s("code",[t._v(".")]),t._v("进行拼接。其中头部和载荷都是以"),s("code",[t._v("JSON")]),t._v("格式存放数据，只是进行了编码【Base64】，签名是根据前两个结果计算而成")]),t._v(" "),s("p",[s("code",[t._v("Token")]),t._v("的使用分成了两部分：")]),t._v(" "),s("ul",[s("li",[t._v("生成token：登录成功的时候，颁发token")]),t._v(" "),s("li",[t._v("验证token：访问某些资源或者接口时，验证token")])]),t._v(" "),s("p",[t._v("所以借助jwt--第三方库"),s("code",[t._v("jsonwebtoken")]),t._v("，通过"),s("code",[t._v("jsonwebtoken")]),t._v(" 的 "),s("code",[t._v("sign")]),t._v(" 方法生成一个 "),s("code",[t._v("token")])]),t._v(" "),s("p",[t._v("在前端接收到"),s("code",[t._v("token")]),t._v("后，一般情况会通过"),s("code",[t._v("localStorage")]),t._v("进行缓存，然后将"),s("code",[t._v("token")]),t._v("放到"),s("code",[t._v("HTTP")]),t._v("请求头"),s("code",[t._v("Authorization")]),t._v(" 中，关于"),s("code",[t._v("Authorization")]),t._v(" 的设置，前面要加上 Bearer ，注意后面带有空格")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// axios请求拦截器")]),t._v("\naxios"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" token "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'token'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bearer '")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 留意这里的 Authorization")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("校验token")])]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("koa-jwt")]),t._v(" 中间件进行验证")]),t._v(" "),s("h3",{attrs:{id:"文件上传"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件上传"}},[t._v("#")]),t._v(" 文件上传")]),t._v(" "),s("p",[t._v("因为浏览器限制，浏览器不能直接操作文件系统的，需要通过浏览器所暴露出来的统一"),s("strong",[t._v("接口")]),t._v("，由用户主动授权发起来访问文件动作，然后读取文件内容进指定内存里，最后执行提交请求操作，将内存里的文件内容数据上传到服务端，服务端解析前端传来的数据信息后存入文件里")]),t._v(" "),s("p",[t._v("文件上传，我们需要设置请求头为"),s("code",[t._v("content-type:multipart/form-data")]),t._v("，因为文件是以二进制的形式存在，其作用是专门用于传输大型二进制数据，效率高")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("action")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://localhost:8080/api/upload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("post"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("enctype")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("multipart/form-data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("multiple")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("multiple"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("submit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("提交"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("form")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[s("code",[t._v("action")]),t._v(" 就是我们的提交到的接口，"),s("code",[t._v('enctype="multipart/form-data"')]),t._v(" 就是指定上传文件格式，"),s("code",[t._v("input")]),t._v(" 的 "),s("code",[t._v("name")]),t._v(" 属性一定要等于"),s("code",[t._v("file")])]),t._v(" "),s("p",[t._v("采用"),s("code",[t._v("koa2")]),t._v("中间件的形式解析上传的文件数据")]),t._v(" "),s("h3",{attrs:{id:"http构建服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http构建服务器"}},[t._v("#")]),t._v(" http构建服务器")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//require表示引包，引包就是引用自己的一个特殊功能")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" url "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"url"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" server "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//得到查询部分，由于写了true，那么就是一个对象")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" queryObj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" age "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" sex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"Content-Type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text/html;charset=UTF-8"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"服务器收到了表单请求"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" age "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" sex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//运行服务器，监听3000端口（端口号可以任改）")]),t._v("\n server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 终端打印如下信息")]),t._v("\n console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Server running at http://127.0.0.1:3000/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"事件循环"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件循环"}},[t._v("#")]),t._v(" 事件循环")]),t._v(" "),s("p",[s("strong",[t._v("浏览器")]),t._v("：同步任务进入执行栈，异步任务进入任务队列，执行栈中任务执行完毕，进入任务队列读取对应任务推入主线程执行，循环往复。")]),t._v(" "),s("p",[t._v("或用宏任务（阶段）和微任务（阶段之间）解释，宏执行完毕后执行清空所有微再执行下一个宏")]),t._v(" "),s("p",[s("strong",[t._v("Node")]),t._v("：事件循环是基于"),s("code",[t._v("libuv")]),t._v("实现，"),s("code",[t._v("libuv")]),t._v("是一个多平台的专注于异步IO的库")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("Node")]),t._v("中，同样存在宏任务和微任务，与浏览器中的事件循环相似")]),t._v(" "),s("p",[t._v("宏任务对应有：")]),t._v(" "),s("ul",[s("li",[t._v("timer queue：setTimeout、setInterval")]),t._v(" "),s("li",[t._v("poll queue：IO事件")]),t._v(" "),s("li",[t._v("check queue：setImmediate")]),t._v(" "),s("li",[t._v("close queue：close事件")])]),t._v(" "),s("p",[t._v("微任务对应有：")]),t._v(" "),s("ul",[s("li",[t._v("next tick queue：process.nextTick")]),t._v(" "),s("li",[t._v("other queue：Promise的then回调、queueMicrotask")])]),t._v(" "),s("p",[t._v("其执行顺序为：【先清空微再宏】")]),t._v(" "),s("ul",[s("li",[t._v("next tick microtask queue 【nextTick优先！】")]),t._v(" "),s("li",[t._v("other microtask queue")]),t._v(" "),s("li",[t._v("timer queue【setTimeout、setInterval】")]),t._v(" "),s("li",[t._v("poll queue【IO】")]),t._v(" "),s("li",[t._v("check queue【setImmediate 立刻低人一等】")]),t._v(" "),s("li",[t._v("close queue")])]),t._v(" "),s("p",[t._v("事件循环分成了6个阶段")]),t._v(" "),s("ul",[s("li",[t._v("定时器检测阶段(timers)：本阶段执行 timer 的回调，即 setTimeout、setInterval 里面的回调函数")]),t._v(" "),s("li",[t._v("I/O事件回调阶段(I/O callbacks)：执行延迟到下一个循环迭代的 I/O 回调，即上一轮循环中未被执行的一些I/O回调")]),t._v(" "),s("li",[t._v("闲置阶段(idle, prepare)：仅系统内部使用")]),t._v(" "),s("li",[t._v("轮询阶段(poll)：检索新的 I/O 事件;执行与 I/O 相关的回调（几乎所有情况下，除了关闭的回调函数，那些由计时器和 setImmediate() 调度的之外），其余情况 node 将在适当的时候在此阻塞")]),t._v(" "),s("li",[t._v("检查阶段(check)：setImmediate() 回调函数在这里执行")]),t._v(" "),s("li",[t._v("关闭事件回调阶段(close callback)：一些关闭的回调函数，如：socket.on('close', ...)")])]),t._v(" "),s("p",[t._v("除了上述6个阶段，还存在"),s("code",[t._v("process.nextTick")]),t._v("，其不属于事件循环的任何一个阶段，它属于该阶段与下阶段之间的过渡, 即本阶段执行结束, 进入下一个阶段前, 所要执行的回调，类似"),s("strong",[t._v("插队")])]),t._v(" "),s("p",[s("strong",[t._v("题目")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async1 start'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async1 end'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'async2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script start'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setImmediate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nprocess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nextTick1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nprocess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nextTick2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise3'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script end'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[t._v("先找到同步任务，输出script start")]),t._v(" "),s("li",[t._v("遇到第一个 setTimeout，将里面的回调函数放到 timer 队列中")]),t._v(" "),s("li",[t._v("遇到第二个 setTimeout，300ms后将里面的回调函数放到 timer 队列中")]),t._v(" "),s("li",[t._v("遇到第一个setImmediate，将里面的回调函数放到 check 队列中")]),t._v(" "),s("li",[t._v("遇到第一个 nextTick，将其里面的回调函数放到本轮同步任务执行完毕后执行")]),t._v(" "),s("li",[t._v("执行 async1函数，输出 async1 start")]),t._v(" "),s("li",[t._v("执行 async2 函数，输出 async2，async2 后面的输出 async1 end进入微任务，等待下一轮的事件循环")]),t._v(" "),s("li",[t._v("遇到第二个nextTick，将其里面的回调函数放到本轮同步任务执行完毕后执行")]),t._v(" "),s("li",[t._v("遇到 new Promise，执行里面的立即执行函数，输出 promise1、promise2")]),t._v(" "),s("li",[t._v("then里面的回调函数进入微任务队列")]),t._v(" "),s("li",[t._v("遇到同步任务，输出 script end")]),t._v(" "),s("li",[t._v("执行下一轮回到函数，先依次输出 nextTick 的函数，分别是 nextTick1、nextTick2")]),t._v(" "),s("li",[t._v("然后执行微任务队列，依次输出 async1 end、promise3")]),t._v(" "),s("li",[t._v("执行timer 队列，依次输出 setTimeout0")]),t._v(" "),s("li",[t._v("接着执行 check 队列，依次输出 setImmediate")]),t._v(" "),s("li",[t._v("300ms后，timer 队列存在任务，执行输出 setTimeout2")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("script start\nasync1 start\nasync2\npromise1\npromise2\nscript end\nnextTick1\nnextTick2\nasync1 end\npromise3\nsetTimeout0\nsetImmediate\nsetTimeout2\n")])])]),s("p",[t._v("易错点：")]),t._v(" "),s("p",[t._v("await async2()会立即执行输出，只是在其后的输出async1 end【类似于回调】进入微任务。")]),t._v(" "),s("p",[t._v("promise1和promise2会一并输出，只是then后的为回调进入微任务队列")]),t._v(" "),s("p",[t._v("nextTick1和nextTick2加入微任务队列在主程序完了后一并优先输出")]),t._v(" "),s("p",[t._v("setTimeout含时间的话会在setImmediate后输出，即便它低一等")]),t._v(" "),s("h3",{attrs:{id:"node性能监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node性能监控"}},[t._v("#")]),t._v(" node性能监控")]),t._v(" "),s("p",[t._v("性能衡量指标：")]),t._v(" "),s("ul",[s("li",[t._v("CPU-负载和使用率")]),t._v(" "),s("li",[t._v("内存-占有率")]),t._v(" "),s("li",[t._v("I/O-缓存")]),t._v(" "),s("li",[t._v("网络")])]),t._v(" "),s("p",[t._v("关于"),s("code",[t._v("Node")]),t._v("的性能优化的方式有：")]),t._v(" "),s("ul",[s("li",[t._v("使用最新版本Node.js")]),t._v(" "),s("li",[t._v("正确使用流 Stream")]),t._v(" "),s("li",[t._v("代码层面优化")]),t._v(" "),s("li",[t._v("内存管理优化")])])])}),[],!1,null,null,null);s.default=e.exports}}]);